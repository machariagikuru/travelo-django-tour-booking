{% extends "base.html" %}
{% load static %}

{% block title %}Book {{ package.title }}{% endblock %}

{% block content %}

<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="bg-light py-3">
  <div class="container">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
      <li class="breadcrumb-item"><a href="{% url 'packages' %}">Packages</a></li>
      <li class="breadcrumb-item"><a href="{% url 'package_detail' package.id %}">{{ package.title }}</a></li>
      <li class="breadcrumb-item active">Booking</li>
    </ol>
  </div>
</nav>

<div class="container my-5">
  <h1 class="display-5 fw-bold mb-4">Complete Your Booking</h1>

  <div class="row">
    <!-- Booking Form -->
    <div class="col-lg-8">
      <form method="post" class="booking-form">
        {% csrf_token %}

        <!-- Package Summary -->
        <div class="card mb-4 border-0 shadow-sm rounded-3">
          <div class="card-body p-4">
            <h5 class="mb-3">Selected Package</h5>
            <div class="row align-items-center">
              <div class="col-md-3">
                <img src="{{ package.image.url }}" class="img-fluid rounded" alt="{{ package.title }}">
              </div>
              <div class="col-md-6">
                <h6 class="fw-bold mb-2">{{ package.title }}</h6>
                <p class="mb-1"><i class="fa fa-map-marker-alt text-primary me-2"></i>{{ package.destination }}</p>
                <p class="mb-0"><i class="fa fa-calendar-alt text-primary me-2"></i>{{ package.days }} Days</p>
              </div>
              <div class="col-md-3 text-end">
                <h5 class="text-primary fw-bold">₹{{ package.price }}</h5>
              </div>
            </div>
          </div>
        </div>

        <!-- Personal Information -->
        <div class="card mb-4 border-0 shadow-sm rounded-3">
          <div class="card-body p-4">
            <h5 class="mb-4">Personal Information</h5>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">First Name *</label>
                <input type="text" class="form-control form-control-lg rounded-3" name="first_name" required>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Last Name *</label>
                <input type="text" class="form-control form-control-lg rounded-3" name="last_name" required>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Email *</label>
                <input type="email" class="form-control form-control-lg rounded-3" name="email" required>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Phone *</label>
                <input type="tel" class="form-control form-control-lg rounded-3" name="phone" required>
              </div>
              <div class="col-12 mb-3">
                <label class="form-label fw-bold">Address *</label>
                <input type="text" class="form-control form-control-lg rounded-3" name="address" required>
              </div>
            </div>
          </div>
        </div>

        <!-- Travel Details -->
        <div class="card mb-4 border-0 shadow-sm rounded-3">
          <div class="card-body p-4">
            <h5 class="mb-4">Travel Details</h5>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Number of Travelers *</label>
                <input type="number" class="form-control form-control-lg rounded-3" name="travelers" min="1" value="1" required>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Preferred Start Date *</label>
                <input type="date" class="form-control form-control-lg rounded-3" name="start_date" required>
              </div>
              <div class="col-12 mb-3">
                <label class="form-label fw-bold">Room Preference</label>
                <select class="form-select form-select-lg rounded-3" name="room_type">
                  <option>Single Room</option>
                  <option>Double Room</option>
                  <option>Suite</option>
                  <option>Villa</option>
                </select>
              </div>
              <div class="col-12">
                <label class="form-label fw-bold">Special Requests</label>
                <textarea class="form-control rounded-3" name="special_requests" rows="3" placeholder="Any special requirements..."></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Terms & Conditions -->
        <div class="card mb-4 border-0 shadow-sm rounded-3">
          <div class="card-body p-4">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="terms" name="terms" required>
              <label class="form-check-label fw-bold" for="terms">
                I agree to the <a href="#" class="text-primary text-decoration-none">Terms & Conditions</a> and <a href="#" class="text-primary text-decoration-none">Privacy Policy</a>
              </label>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary btn-lg w-100 rounded-pill mb-3">
          <i class="fa fa-lock me-2"></i>Proceed to Payment
        </button>
        <a href="{% url 'package_detail' package.id %}" class="btn btn-outline-primary btn-lg w-100 rounded-pill">
          Back to Package Details
        </a>
      </form>
    </div>

    <!-- Booking Summary Sidebar -->
    <div class="col-lg-4">
      <div class="booking-summary sticky-top" style="top: 20px;">
        <div class="card border-0 shadow-lg rounded-3">
          <div class="card-body p-4">
            <h5 class="mb-4">Booking Summary</h5>

            <div class="summary-item d-flex justify-content-between mb-3 pb-3 border-bottom">
              <span class="text-muted">Package Price (per person)</span>
              <span class="fw-bold">₹{{ package.price }}</span>
            </div>

            <div class="summary-item d-flex justify-content-between mb-3 pb-3 border-bottom">
              <span class="text-muted">Number of Travelers</span>
              <span class="fw-bold" id="travelers-count">1</span>
            </div>

            <div class="summary-item d-flex justify-content-between mb-3 pb-3 border-bottom">
              <span class="text-muted">Subtotal</span>
              <span class="fw-bold" id="subtotal">₹{{ package.price }}</span>
            </div>

            <div class="summary-item d-flex justify-content-between mb-3 pb-3 border-bottom">
              <span class="text-muted">GST (18%)</span>
              <span class="fw-bold text-danger" id="gst">₹0</span>
            </div>

            <div class="summary-item d-flex justify-content-between mb-4 pb-4 border-bottom">
              <span class="text-muted">Discount</span>
              <span class="fw-bold text-success">₹0</span>
            </div>

            <div class="summary-item d-flex justify-content-between mb-4">
              <span class="fw-bold fs-5">Total Amount</span>
              <span class="fw-bold fs-5 text-primary" id="total">₹{{ package.price }}</span>
            </div>

            <div class="alert alert-info mb-0">
              <small><i class="fa fa-info-circle me-2"></i>Payment methods will be displayed on the next page</small>
            </div>
          </div>
        </div>

        <!-- Trust Badge -->
        <div class="mt-4 text-center">
          <p class="text-muted mb-2">Safe & Secure Booking</p>
          <i class="fa fa-shield-alt text-primary fa-2x"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .form-control, .form-select {
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
  }

  .form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
  }

  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
  }

  .btn-outline-primary {
    color: #667eea;
    border-color: #667eea;
  }

  .btn-outline-primary:hover {
    background: #667eea;
    border-color: #667eea;
    color: white;
  }

  .card {
    border-radius: 15px;
  }

  .booking-form input, .booking-form select, .booking-form textarea {
    border-radius: 10px !important;
  }
</style>

<script>
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    updatePricing();
  });

  // Update booking summary on travelers change
  document.querySelector('[name="travelers"]').addEventListener('change', updatePricing);

  function updatePricing() {
    const travelers = parseInt(document.querySelector('[name="travelers"]').value) || 1;
    const price = {{ package.price }};
    const subtotal = price * travelers;
    const gst = Math.round(subtotal * 0.18);
    const total = subtotal + gst;

    document.getElementById('travelers-count').textContent = travelers;
    document.getElementById('subtotal').textContent = '₹' + subtotal.toLocaleString('en-IN');
    document.getElementById('gst').textContent = '₹' + gst.toLocaleString('en-IN');
    document.getElementById('total').textContent = '₹' + total.toLocaleString('en-IN');
  }
</script>

{% endblock %}
